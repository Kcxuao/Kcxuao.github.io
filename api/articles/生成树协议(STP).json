{"title":"生成树协议(STP)","uid":"fc3bbc0413ff470b06b0381e61068751","slug":"生成树协议(STP)","date":"2022-08-03T11:59:01.000Z","updated":"2022-08-03T12:05:14.965Z","comments":true,"path":"api/articles/生成树协议(STP).json","keywords":null,"cover":"https://img2.baidu.com/it/u=3220902528,4214668157&fm=253&fmt=auto&app=138&f=PNG?w=500&h=333","content":"<h2 id=\"一、工作原理\"><a href=\"#一、工作原理\" class=\"headerlink\" title=\"一、工作原理\"></a>一、工作原理</h2><ol>\n<li>选择根交换机（网桥）<ul>\n<li>网桥ID小的为根交换机<ul>\n<li>网桥ID（网桥优先级+网桥MAC地址）</li>\n<li>网桥优先级「默认：<code>32768</code>」，可由管理员更改，为 <code>4096</code> 倍数</li>\n</ul>\n</li>\n<li><span style=\"color:red\">根网桥端口不会阻塞</span></li>\n</ul>\n</li>\n<li>选择根端口<ul>\n<li>根路径<span style=\"color:red\">成本最小</span></li>\n<li><span style=\"color:red\">直连网桥ID最小</span></li>\n<li>端口ID最小「默认：<code>128</code>」</li>\n</ul>\n</li>\n<li>选择指定端口<ul>\n<li><span style=\"color:red\">根网桥端口均为指定端口</span></li>\n<li>每个网段需要<span style=\"color:red\">存在一个</span>指定端口</li>\n<li>非根网「<span style=\"color:red\">未与根网桥直连的网段</span>」选择指定端口<ul>\n<li>根路径成本最小</li>\n<li>直连网桥ID最小</li>\n<li>端口ID最小「默认：<code>128</code>」</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><span style=\"color:red\">没有被选中</span>的端口阻塞（BLK）</li>\n</ol>\n<h2 id=\"二、概念\"><a href=\"#二、概念\" class=\"headerlink\" title=\"二、概念\"></a>二、概念</h2><h3 id=\"1-STP收敛\"><a href=\"#1-STP收敛\" class=\"headerlink\" title=\"1. STP收敛\"></a>1. STP收敛</h3><p>​\t\t收敛是生成树过程的一个重要环节。收敛是指网络在一段时间内确定作为根桥的交换机、经过所有不同的端口状态，并且将所有交换机端口设置为其最终的生成树端口角色，而所有潜在的环路都被消除。收敛过程需要耗费一定时间，这是因为其使用各种不同的计时器来协调整个过程。</p>\n<ol>\n<li><p>其收敛过程中，交换机端口存在5种状态</p>\n<ul>\n<li>禁用（Disable）：不收发任何报文<span style=\"color:red\">（端口up后直接进入侦听状态）</span></li>\n<li>阻塞（Blocking）：不收发任何数据帧，接收但不发送BPDU<span style=\"color:red\">（拓扑变更通告），不学习MAC地址</span><ul>\n<li><span style=\"color:red\">拓扑变更：「 20秒接收不到BPDU报文，切换到侦听状态 」</span></li>\n</ul>\n</li>\n<li>侦听（Listenning）：不收发任何数据帧，接收并转发BPDU，不学习MAC地址<ul>\n<li><span style=\"color:red\">侦听～～学习\t转发延迟15秒</span></li>\n</ul>\n</li>\n<li>学习（Learning）：不收发任何数据帧，接收并转发BPDU，学习MAC地址<ul>\n<li><span style=\"color:red\">学习～～转发\t转发延迟15秒</span></li>\n</ul>\n</li>\n<li>转发（Forwarding）：收发任何数据帧，接收并转发BPDU，学习MAC地址</li>\n</ul>\n</li>\n<li><p>计时器</p>\n<ul>\n<li><p><strong>Hello Time定时器：</strong>为周期发送BPDU来<span style=\"color:red\">维护生成树的稳定的时间</span>，默认为2s。如果交换机在配置的超时时间内没有收到上游交换机发送的BPDU，则会重新进行生成树的计算。在根交换机上配置的Hello Time将作为整个生成树内所有的交换机的Hello Time</p>\n</li>\n<li><p><strong>Max Age定时器</strong>：<span style=\"color:red\">BPDU的最大生存时间</span>，默认为20s。交换机通过比较从上游交换机收到的BPDU中携带的Messgae Age（配置BPDU的生存时间，若配置BPDU是根桥发出的，则Message Age为0，每经过一台交换机增加1）和Max Age，来判断这个BPDU是否超时。如果收到的BPDU超时，交换机会将该BPDU老化，同时阻塞接收该BPDU的接口，并开始发出以自己为根桥的BPDU。这种老化机制可以有效的控制生成树的半径。在根交换机上配置的Max Age将作为整个生成树内所有的交换机的Max Age。</p>\n</li>\n<li><p><strong>Forward Delay 定时器</strong>：<span style=\"color:red\">延迟时间为Forward Delay定时器的时间</span>，默认为15s。STP采用了一种端口状态迁移机制，寻选出的根端口和指定端口要经过2倍的Forward Delay延时后才能进入转发状态，这个延时保证了新的配置消息传遍整个网络，使所有参与STP计算的交换机都能正确的知晓网络的状态，可以有效的防止临时环路的产生。在华为交换设备上，由于默认生成树的模式为MSTP，当手工更改生成树模式为STP时，STP端口的状态只有Discarding、Learning、Forwarding3种。在根交换机上配置的延时时间将作为整个生成树内所有的交换机的延时时间</p>\n<p>「 <strong>超时时间&#x3D;3*Hello Time*Timer Factor（时间利用系数）</strong>」</p>\n</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"2-配置\"><a href=\"#2-配置\" class=\"headerlink\" title=\"2. 配置\"></a>2. 配置</h3><p>​\t在交换机中，不同vlan具有不同的STP</p>\n<h4 id=\"1-单生成树（只有一个vlan）\"><a href=\"#1-单生成树（只有一个vlan）\" class=\"headerlink\" title=\"1. 单生成树（只有一个vlan）\"></a>1. 单生成树（只有一个vlan）</h4><ul>\n<li><p>设置网桥优先级</p>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><code class=\"language-cmd\">Switch(config)#spanning-tree vlan [1] priority [4096]<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n</ul>\n<h4 id=\"2-多生成树（多个vlan）\"><a href=\"#2-多生成树（多个vlan）\" class=\"headerlink\" title=\"2. 多生成树（多个vlan）\"></a>2. 多生成树（多个vlan）</h4><h4 id=\"3-其他配置\"><a href=\"#3-其他配置\" class=\"headerlink\" title=\"3. 其他配置\"></a>3. 其他配置</h4><ul>\n<li><p>直接指定根网桥</p>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><code class=\"language-cmd\">Switch(config)#spanning-tree vlan [1] root primary <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li><p>修改端口成本</p>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><code class=\"language-cmd\">Switch(config-if)#spanning-tree vlan [1] cost [19]\n\n# 百兆带宽成本：19\n# 千兆带宽成本：1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>修改端口优先级</p>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><code class=\"language-cmd\">Switch(config-if)#spanning-tree vlan [1] port-priority [64] \n # 参数为16的倍数 <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre></li>\n</ul>\n","text":"一、工作原理 选择根交换机（网桥） 网桥ID小的为根交换机 网桥ID（网桥优先级+网桥MAC地址） 网桥优先级「默认：32768」，可由管理员更改，为 4096 倍数 根网桥端口不会阻塞 选择根端口 根路径成本最小 直连网桥ID最小 端口ID最小「默认：128」 选择指定端口 根...","link":"","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/categories/网络安全.json"},{"name":"网络协议","slug":"网络安全/网络协议","count":1,"path":"api/categories/网络安全/网络协议.json"}],"tags":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/tags/网络安全.json"},{"name":"网络协议","slug":"网络协议","count":1,"path":"api/tags/网络协议.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%E3%80%81%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">一、工作原理</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E3%80%81%E6%A6%82%E5%BF%B5\"><span class=\"toc-text\">二、概念</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-STP%E6%94%B6%E6%95%9B\"><span class=\"toc-text\">1. STP收敛</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">2. 配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#1-%E5%8D%95%E7%94%9F%E6%88%90%E6%A0%91%EF%BC%88%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AAvlan%EF%BC%89\"><span class=\"toc-text\">1. 单生成树（只有一个vlan）</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-%E5%A4%9A%E7%94%9F%E6%88%90%E6%A0%91%EF%BC%88%E5%A4%9A%E4%B8%AAvlan%EF%BC%89\"><span class=\"toc-text\">2. 多生成树（多个vlan）</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#3-%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">3. 其他配置</span></a></li></ol></li></ol></li></ol>","author":{"name":"Kcxuao","slug":"blog-author","avatar":"https://img.gejiba.com/images/d12fcf0171d543a357ba257c1187033f.webp","link":"/","description":"路漫漫其修远兮，吾将上下而求索","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"qq":{"icon":"/img/qq.png","link":"http://wpa.qq.com/msgrd?v=3&uin=3187294487&site=qq&menu=yes"},"github":{"icon":"/img/github.png","link":"https://github.com/Kcxuao"},"email":{"icon":"/img/email.png","link":"mailto:kcxuao@gmail.com"}}}},"mapped":true,"prev_post":{"title":"NMAP使用详解","uid":"a3a1f8d9a7d66f6dde418e09a78c8d1a","slug":"NMAP使用详解","date":"2022-08-22T08:30:17.000Z","updated":"2022-10-02T10:24:20.315Z","comments":true,"path":"api/articles/NMAP使用详解.json","keywords":null,"cover":"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.mp.itc.cn%2Fupload%2F20161230%2Fa91026a08e384bed9f65e512a0f84133_th.jpeg&refer=http%3A%2F%2Fimg.mp.itc.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1663749259&t=cb8b42168e41eb49e68c6bbd426dca6c","text":"一、功能 TIP 主机发现：检测目标主机是否在线 端口扫描：检测端口状态和提供的服务 版本侦测：检测端口提供服务的包或软件的版本信息 操作系统侦测：检测主机使用的操作系统 二、基本使用1.扫描IP地址(网段) nmap -sn 192.168.1.0/24 nmap -sn 19...","link":"","photos":[],"count_time":{"symbolsCount":"6.4k","symbolsTime":"6 mins."},"categories":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/categories/网络安全.json"},{"name":"工具使用","slug":"网络安全/工具使用","count":3,"path":"api/categories/网络安全/工具使用.json"}],"tags":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/tags/网络安全.json"},{"name":"工具使用","slug":"工具使用","count":3,"path":"api/tags/工具使用.json"}],"author":{"name":"Kcxuao","slug":"blog-author","avatar":"https://img.gejiba.com/images/d12fcf0171d543a357ba257c1187033f.webp","link":"/","description":"路漫漫其修远兮，吾将上下而求索","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"qq":{"icon":"/img/qq.png","link":"http://wpa.qq.com/msgrd?v=3&uin=3187294487&site=qq&menu=yes"},"github":{"icon":"/img/github.png","link":"https://github.com/Kcxuao"},"email":{"icon":"/img/email.png","link":"mailto:kcxuao@gmail.com"}}}}},"next_post":{"title":"路由器配置DHCP服务","uid":"2ad3ae89e003a8a229c0b35f48bef705","slug":"路由器配置DHCP服务","date":"2022-08-03T04:46:29.000Z","updated":"2022-08-03T05:31:59.481Z","comments":true,"path":"api/articles/路由器配置DHCP服务.json","keywords":null,"cover":"https://img2.baidu.com/it/u=862501854,459260251&fm=253&fmt=auto&app=120&f=JPEG?w=641&h=500","text":"1. DHCP作用​ 主要作用是集中的管理、分配IP地址，使网络环境中的主机动态的获得IP地址、Gateway地址、DNS服务器地址等信息，并能够提升地址的使用率。 2. 定义DHCP地址池 定义地址池名称 R0(config)#ip dhcp pool [name] 指定分配网...","link":"","photos":[],"count_time":{"symbolsCount":352,"symbolsTime":"1 mins."},"categories":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/categories/网络安全.json"},{"name":"网络设备","slug":"网络安全/网络设备","count":2,"path":"api/categories/网络安全/网络设备.json"}],"tags":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/tags/网络安全.json"},{"name":"网络设备","slug":"网络设备","count":2,"path":"api/tags/网络设备.json"}],"author":{"name":"Kcxuao","slug":"blog-author","avatar":"https://img.gejiba.com/images/d12fcf0171d543a357ba257c1187033f.webp","link":"/","description":"路漫漫其修远兮，吾将上下而求索","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"qq":{"icon":"/img/qq.png","link":"http://wpa.qq.com/msgrd?v=3&uin=3187294487&site=qq&menu=yes"},"github":{"icon":"/img/github.png","link":"https://github.com/Kcxuao"},"email":{"icon":"/img/email.png","link":"mailto:kcxuao@gmail.com"}}}}}}